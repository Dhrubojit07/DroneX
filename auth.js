document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("authLinks"),t=document.getElementById("userProfile"),n=document.getElementById("username"),o=document.getElementById("logoutLink");function i(){return Math.random().toString(36).substr(2,6).toUpperCase()}function a(){const o=JSON.parse(localStorage.getItem("dronexUser"));o?(e.style.display="none",t.style.display="flex",n.textContent=o.name):(e.style.display="flex",t.style.display="none")}document.getElementById("signupForm")&&document.getElementById("signupForm").addEventListener("submit",(e=>{e.preventDefault();const t={name:document.getElementById("signupName").value,email:document.getElementById("signupEmail").value,password:document.getElementById("signupPassword").value,verified:!1,verificationToken:i()},n=document.getElementById("signupConfirmPassword").value;if(t.password!==n)return void alert("Passwords do not match!");const o=JSON.parse(localStorage.getItem("users"))||[];o.some((e=>e.email===t.email))?alert("User already exists!"):(localStorage.setItem("pendingVerification",JSON.stringify({email:t.email,token:t.verificationToken})),alert(`Verification code sent to ${t.email} (simulated): ${t.verificationToken}`),o.push(t),localStorage.setItem("users",JSON.stringify(o)),window.location.href=`verify-email.html?email=${encodeURIComponent(t.email)}`)})),document.getElementById("verifyEmailForm")&&document.getElementById("verifyEmailForm").addEventListener("submit",(e=>{e.preventDefault();const t=new URLSearchParams(window.location.search).get("email"),n=document.getElementById("verificationCode").value,o=JSON.parse(localStorage.getItem("pendingVerification")),i=JSON.parse(localStorage.getItem("users"));if(o&&o.email===t&&o.token===n){const e=i.findIndex((e=>e.email===t));i[e].verified=!0,localStorage.setItem("users",JSON.stringify(i)),localStorage.removeItem("pendingVerification"),localStorage.setItem("dronexUser",JSON.stringify(i[e])),window.location.href="index.html"}else alert("Invalid verification code!")})),document.getElementById("signinForm")&&document.getElementById("signinForm").addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("signinEmail").value,n=document.getElementById("signinPassword").value,o=(JSON.parse(localStorage.getItem("users"))||[]).find((e=>e.email===t&&e.password===n));if(o){if(!o.verified)return alert("Please verify your email first!"),void(window.location.href=`verify-email.html?email=${encodeURIComponent(t)}`);localStorage.setItem("dronexUser",JSON.stringify(o)),a(),window.location.href="index.html"}else alert("Invalid credentials!")})),o&&o.addEventListener("click",(e=>{e.preventDefault(),localStorage.removeItem("dronexUser"),a(),window.location.href="index.html"})),document.getElementById("forgotPasswordForm")&&document.getElementById("forgotPasswordForm").addEventListener("submit",(e=>{e.preventDefault();const t=document.getElementById("resetEmail").value;if((JSON.parse(localStorage.getItem("users"))||[]).some((e=>e.email===t))){const e=i();localStorage.setItem("passwordResetToken",JSON.stringify({email:t,token:e,expires:Date.now()+36e5})),alert(`Password reset link sent (simulated): ${e}`),window.location.href=`reset-password.html?token=${e}`}else alert("Email not found")})),a(),window.addEventListener("storage",a)}));